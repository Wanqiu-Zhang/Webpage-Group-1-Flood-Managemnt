<!DOCTYPE html>
<html lang="en">

<head>
    <title>Interactive Map</title>


    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />


    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <link rel="stylesheet" href="./style.css">

    <style>

    </style>
</head>

<body>
    <div id="map"></div>

    <script type="text/javascript" src="./Greenspace.js"></script>
    <script type="text/javascript" src="./Management.js"></script>
    <script type="text/javascript" src="./SIMDF.js"></script>
    <script type="text/javascript" src="./SIMD.js"></script>
    <script type="text/javascript" src="./Env.js"></script>
    <script type="text/javascript" src="./MediumRiskPop.js"></script>
    <script type="text/javascript" src="./defences.js"></script>
    <script type="text/javascript" src="./FloodMediumRisk.js"></script>
    <script type="text/javascript" src="./SEPA.js"></script>
    <script type="text/javascript" src="./Proposed.js"></script>
    <script type="text/javascript" src="./River.js"></script>
    <script type="text/javascript" src="./City.js"></script>
    <script type="text/javascript" src="./Culvert.js"></script>


    

    <script type="text/javascript">

        //define map
        var map = L.map('map', {
            minZoom: 10,
            maxZoom: 16,
        });

        //zoom in the position of Edinburgh   
        map.setView([55.92, -3.285], 10.5);
        //55.91787, -3.303865
        //scale
        L.control.scale().addTo(map);

        //zoom viewer
        const ZoomViewer = L.Control.extend({
            onAdd() {
                const gauge = L.DomUtil.create('div');
                gauge.style.width = '100px';
                gauge.style.background = 'rgba(255,255,255,0.5)';
                gauge.style.textAlign = 'left';
                map.on('zoomstart zoom zoomend', (ev) => {
                    gauge.innerHTML = `Zoom level: ${map.getZoom()}`;
                });
                return gauge;
            }
        });
        const zoomViewer = (new ZoomViewer()).addTo(map);


        //basemap
        const osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        const grey = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
            attribution: '©OpenStreetMap, ©CartoDB'
        })

        //layer control
        var baseMaps = {
            "OpenStreetMap": osm,
            "Grey": grey
        };

        /*
        var overlayMaps = {
           "Cities": cities};*/

        var layerControl = L.control.layers(baseMaps).addTo(map);




        // get color depending on greenspace area value
        function getColor1(d) {
            if (d == 'Play Space') { return '#a1d99b' }
            else if (d == 'Playing Field') { return '#41ab5d' }
            else if (d == 'Public Park Or Garden') { return '#006d2c' }
        }
        
        // get color depending on greenspace per person value
        function getColor2(d) {
            return d >= 2050 ? '#006d2c' :
                d >= 1000 ? '#41ab5d' :
                    d >= 300 ? '#a1d99b' :
                        d >= 100 ? '#c7e9c0' :
                            '#e5f5e0';
        }

        // get color depending on SIMD Full value
        function getColor3(d) {
            return d >= 6976 ? '#003061' :
                d >= 6672 ? '#2166AC' :
                    d >= 6310 ? '#4393C3' :
                        d >= 5828 ? '#92C5DE' :
                            d >= 5134 ? '#D1E5F0' :
                                d >= 4359 ? '#FDDBC7' :
                                    d >= 3607 ? '#F4A582' :
                                        d >= 2814 ? '#D6604D' :
                                            d >= 1898 ? '#B2182B' :
                                                d >= 911 ? '#67001F' :
                                                    '#F7FDFD';
        }

        // get color depending on population value
        function getColor4(d) {
            return d >= 1000 ? '#BD0026' :
                d >= 500 ? '#F03B20' :
                    d >= 100 ? '#FD8C3C' :
                        d >= 50 ? '#FECC5D' :
                            d >= 1 ? '#FEFFB1' :
                                '#F7FDFD';
        }

        // get color depending defence type
        function getColor5(d) {
            if (d == 'Embankment') { return '#00733B' }
            else if (d == 'Flood Wall') { return '#876900' }
            else if (d == 'Flood Gate') { return '#141414' }
        }

        // get color depending Management
        function getColor6(d) {
            if (d == 'SPEA Opportunity') { return '#FD76DF' }
            else if (d == 'Proposed Opportunity') { return '#B72FE9' }
        }

        // get color depending on Urban SIMD value
        function getColor7(d) {
            return d >= 6976 ? '#F7FDFD':
                d >= 6672 ? '#000000' :
                    d >= 6310 ? '#252525' :
                        d >= 5828 ? '#525252' :
                            d >= 5134 ? '#737373' :
                                d >= 4359 ? '#969696' :
                                    d >= 3607 ? '#bdbdbd' :
                                        d >= 2814 ? '#d9d9d9' :
                                            d >= 1898 ? '#f0f0f0' :
                                                d >= 911 ? '#ffffff' :
                                                    '#F7FDFD';
        }

        //custom icon
        var DamIcon = L.icon({
            iconUrl: './Image/Dam.png',
            iconSize: [50.7, 45.4],
            iconAnchor: [12.4, 10.4],
        });

        var BigBarrierIcon = L.icon({
            iconUrl: './Image/BigBarrier.png',
            iconSize: [50.7, 45.4],
            iconAnchor: [12.4, 10.4],
        });

        var SmallBarrierIcon = L.icon({
            iconUrl: './Image/SmallBarrier.png',
            iconSize: [50.7, 45.4],
            iconAnchor: [12.4, 10.4],
        });

        var GateIcon = L.icon({
            iconUrl: './Image/Gate.png',
            iconSize: [48.7, 32.4],
            iconAnchor: [12.4, 10.4],
        });


        //Style
        //Greenspace color
        function style1(feature) {
            return {
                fillColor: getColor1(feature.properties.function),
                weight: 1.5,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 1
            };
        }

        //Env
        function style2(feature) {
            return {
                fillColor: getColor2(feature.properties.GreenAreaPerPerson),
                weight: 1,
                opacity: 1,
                color: getColor2(feature.properties.GreenAreaPerPerson),
                fillOpacity: 0.8
            };
        }

        //SIMD
        function style3(feature) {
            return {
                fillColor: getColor3(feature.properties.SIMD2020v2),
                weight: 0.2,
                opacity: 0.4,
                color: 'white',
                fillOpacity: 1
            };
        }//SIMD2020v2_Rank

        //Urban SIMD
        function style4(feature) {
            return {
                fillColor: getColor7(feature.properties.SIMD2020v2),
                weight: 1,
                opacity: 0.5,
                color: 'white',
                fillOpacity: 0.65
            };
        }

        //POP
        function style5(feature) {
            return {
                fillColor: getColor4(feature.properties.Population),
                weight: 1,
                opacity: 0.5,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.65
            };
        }

        //Defence
        function style6(feature) {
            return {
                color: getColor5(feature.properties.defences),
                weight: 4,
                opacity: 1,
            };
        }

        //Culvert
        function style7(feature) {
            return {
                color: '#88419d',
                weight: 4,
                opacity: 1,
            };
        }

        //SEPA Opportunity
        function style8(feature) {
            return {
                //fillColor: '',
                weight: 3,
                opacity: 1,
                color: '#FD76DF',
                //dashArray: '3',
                fillOpacity: 0.1
            };
        }

        //Proposed Opportunity
        function style9(feature) {
            return {
                weight: 3,
                opacity: 1,
                color: '#B72FE9',
                fillOpacity: 0.1
            };
        }

        //Medium Flood Risk
        function style11(feature) {
            return {
                fillColor: '#74a9cf',
                weight: 1,
                opacity: 1,
                color: '#74a9cf',
                fillOpacity: 1
            };
        }

        //Edinburgh River
        function style12(feature) {
            return {
                fillColor: '#84BBFE',
                weight: 2,
                opacity: 1,
                color: '#84BBFE',
                fillOpacity: 1
            };
        }

        //City
        function style13(feature) {
            return {
                fillColor: '#2171b5',
                weight: 1.5,
                opacity: 1,
                color: '#000000',
                fillOpacity: 0
            };
        }


        /* global Data */

        geojson1 = L.geoJson(Greenspace, {
            style: style1,
            onEachFeature: onEachFeature1
        });

        geojson2 = L.geoJson(Env, {
            style: style2,
            onEachFeature: onEachFeature2
        })

        geojson3 = L.geoJson(SIMD, {
            style: style3,
            onEachFeature: onEachFeature3
        })

        geojson4 = L.geoJson(SIMDF, {
            style: style3,
            onEachFeature: onEachFeature3
        })

        geojson5 = L.geoJson(River, {
            style: style12,
        })



        var Dam = L.geoJSON(Management, {
            //onEachFeature: onEachFeature5,
            filter: function (Management, layer) {
                return Management.properties.Note == 'Dam';
            },
            pointToLayer: function (Management, latlng) {
                return L.marker(latlng, { icon: DamIcon }).bindPopup("Dam");
            }
        });

        var BigBarrier = L.geoJSON(Management, {
            //onEachFeature: onEachFeature5,
            filter: function (Management, layer) {
                return Management.properties.Note == 'Big Barrier';
            },
            pointToLayer: function (Management, latlng) {
                return L.marker(latlng, { icon: BigBarrierIcon }).bindPopup("Big Barrier");
            }
        });

        var SmallBarrier = L.geoJSON(Management, {
            //onEachFeature: onEachFeature5,
            filter: function (Management, layer) {
                return Management.properties.Note == 'Small Barrier';
            },
            pointToLayer: function (Management, latlng) {
                return L.marker(latlng, { icon: SmallBarrierIcon }).bindPopup("Small Barrier");
            }
        });

        var Gate = L.geoJSON(Management, {
            //onEachFeature: onEachFeature5,
            filter: function (Management, layer) {
                return Management.properties.Note == 'Flood Gate';
            },
            pointToLayer: function (Management, latlng) {
                return L.marker(latlng, { icon: GateIcon }).bindPopup("Flood Gate");
            }
        });


        geojson6 = L.geoJson(MediumRisk, {
            style: style5,
        })

        geojson8 = L.geoJson(defence, {
            style: style6,
        })

        geojson9 = L.geoJson(Culvert, {
            style: style7,
        })

        geojson11 = L.geoJson(FloodMediumRisk, {
            style: style11,
        })

        geojson12 = L.geoJson(SEPA, {
            style: style8,
        })

        geojson13 = L.geoJson(Proposed, {
            style: style9,
        })

        geojson14 = L.geoJson(City, {
            style: style13,
        })
        
        
        RiverManagement = L.layerGroup([Dam, BigBarrier, SmallBarrier, Gate,geojson8,geojson9,geojson12,geojson13,geojson5,geojson14]);
        MediumRiskFlooding = L.layerGroup([geojson6,geojson14])
        Flooding = L.layerGroup([geojson11,geojson14]).addTo(map);
        Greenspaces=L.layerGroup([geojson1,geojson14]);
       

        //information for mouse over Env
        var info2 = L.control();

        info2.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info2'); // create a div with a class "info"
            this.update();
            return this._div;
        };

        info2.update = function (props) {
            this._div.innerHTML = '<h4>Environment Deprivation</h4>' + (props ?
                '<b>' + props.Name + '</b><br />' + props.GreenAreaPerPerson + ' m<sup>2</sup>'
                : 'Hover over');
        };


        //information for mouse over SIMD Rank
        var info3 = L.control();

        info3.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info3'); // create a div with a class "info"
            this.update();
            return this._div;
        };

        info3.update = function (props) {
            this._div.innerHTML = '<h4>SIMD Rank</h4>' + (props ?
                '<b>' + props.Name + '</b><br />' + props.SIMD2020v2
                : 'Hover over');
        };


        //style for hight feature
        function highlightFeature1(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });
            layer.bringToFront();
        }

        function highlightFeature2(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            layer.bringToFront();
            info2.update(layer.feature.properties);

        }

        function highlightFeature3(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            layer.bringToFront();
            info3.update(layer.feature.properties);

        }

        function highlightFeature4(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            layer.bringToFront();
        }

    

        function resetHighlight1(e) {
            geojson1.resetStyle(e.target);
        }

        function resetHighlight2(e) {
            geojson2.resetStyle(e.target);
            info2.update();
        }

        function resetHighlight3(e) {
            geojson4.resetStyle(e.target);
            info3.update();
        }

        function resetHighlight4(e) {
            geojson3.resetStyle(e.target);
        }


        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        function onEachFeature1(feature, layer) {
            layer.on({
                mouseover: highlightFeature1,
                mouseout: resetHighlight1,
                click: zoomToFeature
            });
        }

        function onEachFeature2(feature, layer) {
            layer.on({
                mouseover: highlightFeature2,
                mouseout: resetHighlight2,
                click: zoomToFeature
            });
        }

        function onEachFeature3(feature, layer) {
            layer.on({
                mouseover: highlightFeature3,
                mouseout: resetHighlight3,
                click: zoomToFeature
            });
        }

        function onEachFeature4(feature, layer) {
            layer.on({
                mouseover: highlightFeature4,
                mouseout: resetHighlight4,
                click: zoomToFeature
            });
        }


        layerControl.addOverlay(Flooding, 'Medium Flood In Edinburgh');
        layerControl.addOverlay(MediumRiskFlooding, 'People Affected By Medium Flood');
        layerControl.addOverlay(RiverManagement, 'River Management');
    
        layerControl.addOverlay(geojson2, 'Environment Deprivation');
        layerControl.addOverlay(Greenspaces, 'Accessible Greenspace');

        layerControl.addOverlay(geojson3, 'Scottish Index of Multiple Deprivation');
        layerControl.addOverlay(geojson14, 'Edinburgh City');




        //Accessible Greenspaces
        var legend1 = L.control({ position: 'bottomright' });

        legend1.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info2 legend1'),
                grades = ['Play Space', 'Playing Field', 'Public Park Or Garden']
            div.innerHTML = '<h4>Accessible Greenspaces</h4>'

            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length; i++) {

                div.innerHTML +=
                    '<i style="background:' + getColor1(grades[i]) + '"></i> ' +
                    grades[i] + (grades[i + 1] ? '<br>' : '');

            }
            return div;
        };

        //Greenspace Provision
        var legend2 = L.control({ position: 'bottomright' });

        legend2.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info2 legend2'),
                grades = [0, 100, 300, 1000, 2050, 4100]

            div.innerHTML = '<h4>Greenspace Provision(m<sup>2</sup>) </br>Per Person </h4>'
            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length - 1; i++) {

                div.innerHTML +=
                    '<i style="background:' + getColor2(grades[i]) + '"></i> ' +
                    //grades[i] + (grades[i + 1] ? '<br>' : '');
                    (grades[i + 1] ? + grades[i] + '&ndash;' + grades[i + 1] + '<br>' : '');
            }
            return div;
        };


        //SIMD Rank
        var legend3 = L.control({ position: 'bottomright' });

        legend3.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info2 legend3'),
                grades = [911, 1898, 2814, 3607, 4359, 5134, 5828, 6310, 6672, 6976]

            div.innerHTML = '<h4>SIMD Rank</h4>'

            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length - 1; i++) {

                div.innerHTML +=
                    '<i style="background:' + getColor3(grades[i]) + '"></i> ' +
                    //grades[i] + (grades[i + 1] ? '<br>' : '');
                    (grades[i + 1] ? + grades[i] + '&ndash;' + grades[i + 1] + '<br>' : '');
            }
            return div;
        };


        //Population Affected By Flood
        var legend4 = L.control({ position: 'bottomright' });

        legend4.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info2 legend4'),
                grades = [1, 50, 100, 500, 1000]

            div.innerHTML = '<h4>Population Affected By Flood</h4>'

            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length; i++) {

                div.innerHTML +=
                    '<i style="background:' + getColor4(grades[i]) + '"></i> ' +
                    //grades[i] + (grades[i + 1] ? '<br>' : '');
                    grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
            }
            return div;
        };


        //Defences
        var legend5 = L.control({ position: 'bottomright' });

        legend5.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info2 legend5'),
                grades = ['Embankment', 'Flood Wall', 'Flood Gate']

            div.innerHTML = '<h4>Defences</h4>'
            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length; i++) {
                div.innerHTML +=
                    '<i style="background:' + getColor5(grades[i]) + '"></i> ' +
                    grades[i] + (grades[i + 1] ? '<br>' : '');
            }
            return div;
        };

        //Pressure
        var legend6 = L.control({ position: 'bottomright' });

        legend6.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info2 legend6'),
                grades = ['Culvert']

            div.innerHTML = '<h4>Pressure</h4>'
            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length; i++) {
                div.innerHTML +=
                '<i style="background:' + '#88419d' + '"></i> ' +
                    grades[i] + (grades[i + 1] ? '<br>' : '');
            }
            return div;
        };

        //Opportunity
        var legend7 = L.control({ position: 'bottomright' });

        legend7.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info2 legend7'),
                    grades = ['SPEA Opportunity', 'Proposed Opportunity']

                div.innerHTML = '<h4>Opportunity</h4>'
                // loop through our density intervals and generate a label with a colored square for each interval
                for (var i = 0; i < grades.length; i++) {
                    div.innerHTML +=
                        '<i style="background:' + getColor6(grades[i]) + '"></i> ' +
                        grades[i] + (grades[i + 1] ? '<br>' : '');
                }
                return div;
            };

        //Urban SIMD Rank
        var legend8 = L.control({ position: 'bottomright' });

        legend8.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info2 legend8'),
            grades = [911, 1898, 2814, 3607, 4359, 5134, 5828, 6310, 6672, 6976]

            div.innerHTML = '<h4>Urban SIMD Rank</h4>'

            for (var i = 0; i < grades.length - 1; i++) {

                div.innerHTML +=
                    '<i style="background:' + getColor7(grades[i]) + '"></i> ' +
                    (grades[i + 1] ? + grades[i] + '&ndash;' + grades[i + 1] + '<br>' : '');
            }
            return div;
        };

        //DamIcon,BigBarrierIcon,SmallBarrierIcon,GateIcon

        map.on('overlayadd', function (eventLayer) {
            if (eventLayer.name == 'Accessible Greenspace') {
                this.removeControl(legend2);
                this.removeControl(legend3);
                this.removeControl(legend4);
                this.removeControl(legend5);
                this.removeControl(legend6);
                this.removeControl(legend7);
                this.removeControl(legend8);
                this.removeControl(info2);
                this.removeControl(info3);
                legend1.addTo(map);
            }
            else if (eventLayer.name == 'Medium Flood In Edinburgh') {
                this.removeControl(legend1);
                this.removeControl(legend2);
                this.removeControl(legend3);
                this.removeControl(legend4);
                this.removeControl(legend5);
                this.removeControl(legend6);
                this.removeControl(legend7);
                this.removeControl(legend8);
                this.removeControl(info2);
                this.removeControl(info3);
            }
            else if (eventLayer.name == 'Environment Deprivation') {
                this.removeControl(legend1);
                this.removeControl(legend3);
                this.removeControl(legend4);
                this.removeControl(legend5);
                this.removeControl(legend6);
                this.removeControl(legend7);
                this.removeControl(legend8);
                this.removeControl(info3);
                legend2.addTo(map);
                info2.addTo(map);
            }
            else if (eventLayer.name == 'River Management') {
                this.removeControl(legend1);
                this.removeControl(legend2);
                this.removeControl(legend3);
                this.removeControl(legend4);
                this.removeControl(legend8);
                this.removeControl(info2);
                this.removeControl(info3);
                legend7.addTo(map);
                legend5.addTo(map);
                legend6.addTo(map);
            }
            else if (eventLayer.name == 'Scottish Index of Multiple Deprivation') {
                this.removeControl(legend1);
                this.removeControl(legend2);
                this.removeControl(legend4);
                this.removeControl(legend5);
                this.removeControl(legend6);
                this.removeControl(legend7);
                this.removeControl(legend8);
                this.removeControl(info2);
                legend3.addTo(map);
                info3.addTo(map);
            }
            else if (eventLayer.name == 'People Affected By Medium Flood') {
                this.removeControl(legend1);
                this.removeControl(legend2);
                this.removeControl(legend3);
                this.removeControl(legend5);
                this.removeControl(legend6);
                this.removeControl(legend7);
                this.removeControl(legend8);
                this.removeControl(info2);
                this.removeControl(info3);
                legend4.addTo(map);
            }
        }
        );


    </script>



</body>

</html>