<!DOCTYPE html>
<html lang="'en-GB">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,  initial-scale=1">
  <title>CGS Flood Management </title>
  <link rel="stylesheet" href="./styles/main.css">
  <link rel="stylesheet" href="./styles/map.css">
  <!-- W3CSS -->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <!-- Container -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Data file -->
  <script type="text/javascript" src="data/data_proposal.js"></script>
  <script type="text/javascript" src="data/Greenspace.js"></script>
  <script type="text/javascript" src="data/Management.js"></script>
  <script type="text/javascript" src="data/SIMD.js"></script>
  <script type="text/javascript" src="data/Env.js"></script>
  <script type="text/javascript" src="data/MediumRiskPop.js"></script>
  <script type="text/javascript" src="data/defences.js"></script>
  <script type="text/javascript" src="data/FloodMediumRisk.js"></script>
  <script type="text/javascript" src="data/SEPA.js"></script>
  <script type="text/javascript" src="data/Proposed.js"></script>
  <script type="text/javascript" src="data/River.js"></script>
  <script type="text/javascript" src="data/City.js"></script>
  <script type="text/javascript" src="data/Culvert.js"></script>
  <script type="text/javascript" src="data/Education.js"></script>
  <script type="text/javascript" src="data/Healthcare.js"></script>
  <script type="text/javascript" src="data/Food.js"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
  <script src="plugins/leaflet-polygon.fillPattern.js"></script>
  <!-- Routing Machine -->
  <script src="plugins/leaflet-routing-machine.js"></script>
  <link rel="stylesheet" href="plugins/leaflet-routing-machine.css">
  <!-- introjs-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/6.0.0/intro.js" integrity="sha512-iC2jUAfCjQVVR2eGiPYjV2lb7ZIF0Tx3xPj/PdGZSJkSJVz5y+88tRwshNmrso1twhzhSQwBPXNLdAqUYmRAPg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/6.0.0/introjs.css" integrity="sha512-4OzqLjfh1aJa7M33b5+h0CSx0Q3i9Qaxlrr1T/Z+Vz+9zs5A7GM3T3MFKXoreghi3iDOSbkPMXiMBhFO7UBW/g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
  <div data-title="Welcome!ðŸ¤—" data-intro="Here you can interact yourself with our map and data! Please spend a few time to follow our user guide journey...(Press ENTER to go to the next step more quickly)" class="card-demo">
    <!-- Navbar -->
    <div class="topnav sticky-top" style="margin-bottom: 0px;">
      <a href="https://www.geos.ed.ac.uk/~s2412750/cgs_flood/index.html">Home</a>
      <a href="https://www.geos.ed.ac.uk/~s2412750/cgs_flood/find.html">Report</a>
      <a class="active" href="map.html">Visualisation</a>
      <a href="https://www.geos.ed.ac.uk/~s2412750/cgs_flood/info.html">Other Research</a>
      <a href="https://www.geos.ed.ac.uk/~s2412750/cgs_flood/team.html">About us</a>
    </div>
    <!-- Main contents -->
    <div class="container" style="max-width:100%">
      <div class="row d-flex">
        <!-- Left side function bar -->
        <div class="col-sm-2" style="margin-top: 20px; overflow: auto; height: 85vh;">
          <!-- Page Guide -->
          <div data-intro="You can get the directions to one of the assessible greenspaces larger than 20 heatares by: 1ï¸âƒ£opening this tag 2ï¸âƒ£choosing the target greenspace 3ï¸âƒ£clicking 'Route'!" class="card-demo">
            <!-- Navigating function -->
            <button onclick="accordion('routing')" class="w3-button w3-block w3-left-align">
              <b>Routing to Greenspace</b>
            </button>
            <div id="routing" class="w3-container w3-hide">
              <p>Go to greenspaces to relax yourself after classes!</p>
              <form class="w3-container">
                <select class="w3-select w3-border" name="option">
                  <option value="" disabled selected>Desternation Greenspace</option>
                  <option value="1">Bonaly Country Park</option>
                  <option value="2">Burdiehouse Burn Valley Park</option>
                  <option value="3">Cammo Park</option>
                  <option value="4">Colinton and Craiglockhart Dells</option>
                  <option value="5">Corstophine Hill Local Nature Reserve</option>
                  <option value="6">Craigmillar Castle Park</option>
                  <option value="7">Hermitage of Braid and Blackford Hill Local Nature Reserve</option>
                  <option value="8">Holyrood Park</option>
                  <option value="9">Hunter's Hall Public Park</option>
                  <option value="10">Inverleith Park</option>
                  <option value="11">Royal Botanic Garden and Arboretum</option>
                </select><p></p>
                <button type="button" onclick="route(option.value)" class="w3-btn w3-teal">Route</button><p></p>
              </form>
            </div>
          </div>
          <!-- Page Guide -->
          <div data-intro="Some special layers including the existing river management methods and our proposal for flooding can be separately turned on and off here." class="card-demo">
            <!-- Layer control outside the map -->
            <button onclick="accordion('layer')" class="w3-button w3-block w3-left-align">
              <b>Special Layer Control</b>
            </button>
            <div id="layer" class="w3-container w3-hide">
              <details>
                <summary>River Management</summary>
                <div class="w3-display-container w3-hover-opacity" onclick="turnondam()">
                  <img src="./images/dam_400.jpg" alt="dam" >
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Dam</div>
                </div>

                <div style="margin-top:10px" class="w3-display-container w3-hover-opacity" onclick="turnonbarrier()">
                  <img src="./images/barrier_400.jpg" alt="Barrier">
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Barrier</div>
                </div>

                <div style="margin-top:10px" class="w3-display-container w3-hover-opacity" onclick="turnongate()">
                  <img src="./images/floodgate_400.jpg" alt="Flood Gate">
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Flood Gate</div>
                </div>

                <div style="margin-top:10px" class="w3-display-container w3-hover-opacity" onclick="turnonculvert()">
                  <img src="./images/culvert_400.jpg" alt="Culvert">
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Culvert</div>
                </div>

                <div style="margin-top:10px" class="w3-display-container w3-hover-opacity" onclick="turnondefence()">
                  <img src="./images/defences_400.jpg" alt="Defences" >
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Embankment<p><br><br><br><br></p>Flood Wall</div>
                </div>
              </details>
              <details>
                <summary>Proposed Greenspace</summary>
                <div class="w3-display-container w3-hover-opacity" onclick="turnonwoodland()">
                  <img src="./images/woodland_400.jpg" alt="Woodland!!!" >
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Woodland</div>
                </div>
                
                <div style="margin-top:10px" class="w3-display-container w3-hover-opacity" onclick="turnonmeadow()">
                  <img src="./images/meadow_400.jpg" alt="Meadow">
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Meadow</div>
                </div>
                <div style="margin-top:10px" class="w3-display-container w3-hover-opacity" onclick="turnonwillow()">
                  <img src="./images/willow_400.jpg" alt="Livingwillow" >
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Livingwillow</div>
                </div>
                <div style="margin-top:10px" class="w3-display-container w3-hover-opacity" onclick="turnonbush()">
                  <img src="./images/bush_400.jpg" alt="Bush" >
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Bush</div>
                </div>
                <div style="margin-top:10px" class="w3-display-container w3-hover-opacity" onclick="turnonlargewood()">
                  <img src="./images/largewood_400.jpg" alt="Large Wood">
                  <div class="w3-display-middle w3-large" style="color: rgb(255, 255, 255); text-shadow:1.5px 1.5px 0 rgb(0, 0, 0)">Large Wood</div>
                </div>
              </details>
            </div>
          </div>
          <!-- Unfinished Quieries Function -->
          <!--
          <div data-intro="You can perform queries by accessing our Oracle database here." class="card-demo">
            <button onclick="accordion('oracle')" class="w3-button w3-block w3-left-align">
              <b>Quries</b>
            </button>
            <div id="oracle" class="w3-container w3-hide">
              <p>Coming soon...</p>
            </div>
          </div>
          -->
        </div>
        <!-- Map -->
        <div style="height: 89vh" id="mapid" class="col-sm-10">
          <!-- Page Guide -->
          <div style="height: 89vh" data-title="Map & DataðŸ—ºï¸" data-intro="Ta-da!! All data will be presented here! You can also use the layer control inside the map on the up right coner to explore more. EnjoyðŸ˜Š!" class="card-demo"></div>
        </div>  
      </div>
    </div>
    <!-- Footer -->
    <footer > 
      <div class="title">
        <h6>The University of Edinburgh</h6>
      </div>
      <div class="copyright">
        <p>
          Unless explicitly stated, all material is copyright Â© University of Edinburgh 2023.
        </p>
      </div>
    </footer>
  </div>
</body>

<script language = "JavaScript">
  // Functions
  // get color depending on greenspace area value
  function getColor1(d) {
    if (d == 'Play Space') { return '#a1d99b' }
    else if (d == 'Playing Field') { return '#41ab5d' }
    else if (d == 'Public Park Or Garden') { return '#006d2c' }
  };
  // get color depending on greenspace per person value
  function getColor2(d) {
    return d >= 2050 ? '#006d2c' :
            d >= 1000 ? '#41ab5d' :
              d >= 300 ? '#a1d99b' :
                d >= 100 ? '#c7e9c0' :
                  '#e5f5e0';
  };
  // get color depending on SIMD value
  function getColor3(d) {
    return d >= 6976 ? '#003061' :
            d >= 6672 ? '#2166AC' :
              d >= 6310 ? '#4393C3' :
                d >= 5828 ? '#92C5DE' :
                  d >= 5134 ? '#D1E5F0' :
                    d >= 4359 ? '#FDDBC7' :
                      d >= 3607 ? '#F4A582' :
                        d >= 2814 ? '#D6604D' :
                          d >= 1898 ? '#B2182B' :
                            d >= 911 ? '#67001F' :
                              '#F7FDFD';
  };
  // get color depending on population value
  function getColor4(d) {
    return d >= 1000 ? '#BD0026' :
            d >= 500 ? '#F03B20' :
              d >= 100 ? '#FD8C3C' :
                d >= 50 ? '#FECC5D' :
                  d >= 1 ? '#FEFFB1' :
                    '#F7FDFD';
  };
  // get color depending defence type
  function getColor5(d) {
    if (d == 'Embankment') { return '#00733B' }
    else if (d == 'Flood Wall') { return '#876900' }
    else if (d == 'Flood Gate') { return '#141414' }
  };
  // get color depending Management
  function getColor6(d) {
    if (d == 'SPEA Opportunity') { return '#FD76DF' }
    else if (d == 'Proposed Opportunity') { return '#B72FE9' }
  };
 
  //get color depending on social deprivation
     function getColor8(d) {
            if (d == 'Education Services Area') { return '#6FBCD8' }
            else if (d == 'Healthcare Services Area') { return '#EAE856' }
            else if (d == 'Food Services Area') { return '#DDAF8E' }

        }
  // Styles functions
  // Greenspace color
  function style1(feature) {
    return {
      fillColor: getColor1(feature.properties.function),
      weight: 1.5,
      opacity: 1,
      color: 'white',
      dashArray: '3',
      fillOpacity: 1
    };
  };
  // Env
  function style2(feature) {
    return {
      fillColor: getColor2(feature.properties.GreenAreaPerPerson),
      weight: 1,
      opacity: 1,
      color: getColor2(feature.properties.GreenAreaPerPerson),
      fillOpacity: 0.8
    };
  };
  // SIMD
  function style3(feature) {
    return {
      fillColor: getColor3(feature.properties.SIMD2020v2),
      weight: 0.2,
      opacity: 0.4,
      color: 'white',
      fillOpacity: 1
    };
  };
  
  // POP
  function style5(feature) {
    return {
      fillColor: getColor4(feature.properties.Population),
      weight: 1,
      opacity: 0.5,
      color: 'white',
      dashArray: '3',
      fillOpacity: 0.65
    };
  };
  // Defence
  function style6(feature) {
    return {
      color: getColor5(feature.properties.defences),
      weight: 4,
      opacity: 1,
    };
  };
  // Culvert
  function style7(feature) {
    return {
      color: '#88419d',
      weight: 4,
      opacity: 1,
    };
  };
  // SEPA Opportunity
  function style8(feature) {
    return {
      weight: 3,
      opacity: 1,
      color: '#FD76DF',
      fillOpacity: 0.1
    };
  };
  // Proposed Opportunity
  function style9(feature) {
    return {
      weight: 3,
      opacity: 1,
      color: '#B72FE9',
      fillOpacity: 0.1
    };
  };
  // Medium Flood Risk
  function style11(feature) {
    return {
      fillColor: '#74a9cf',
      weight: 1,
      opacity: 1,
      color: '#74a9cf',
      fillOpacity: 1
    };
  };
  //Edinburgh River
  function style12(feature) {
    return {
      fillColor: '#84BBFE',
      weight: 2,
      opacity: 1,
      color: '#84BBFE',
      fillOpacity: 1
    };
  };
  //City
  function style13(feature) {
    return {
      fillColor: '#2171b5',
      weight: 1.5,
      opacity: 1,
      color: '#000000',
      fillOpacity: 0
    };
  };
  
  //Education
        function style14(feature) {
            return {
                fillColor: '#6FBCD8',
                weight: 1.5,
                opacity: 1,
                color: '#6FBCD8',
                fillOpacity: 0.4
            };
        }

        //Healthcare
        function style15(feature) {
            return {
                fillColor: '#EAE856',
                weight: 1.5,
                opacity: 1,
                color: '#EAE856',
                fillOpacity: 0.4
            };
        }
  
  //Food
        function style16(feature) {
            return {
                fillColor: '#DDAF8E',
                weight: 1.5,
                opacity: 1,
                color: '#DDAF8E',
                fillOpacity: 0.1
            };
        }
  
 
  //style for hight feature
  
  function highlightFeature2(e) {
    var layer = e.target;
    layer.setStyle({
      weight: 5,
      color: '#666',
      dashArray: '',
      fillOpacity: 0.7
    });
    layer.bringToFront();
    info2.update(layer.feature.properties);
  };
  function highlightFeature3(e) {
    var layer = e.target;
    layer.setStyle({
      weight: 5,
      color: '#666',
      dashArray: '',
      fillOpacity: 0.7
    });
    layer.bringToFront();
    info3.update(layer.feature.properties);
  };
  
 
  function resetHighlight2(e) {
    geojson2.resetStyle(e.target);
    info2.update();
  };
  function resetHighlight3(e) {
    geojson3.resetStyle(e.target);
    info3.update();
  };
 
  function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
  };
  
  function onEachFeature2(feature, layer) {
    layer.on({
      mouseover: highlightFeature2,
      mouseout: resetHighlight2,
      click: zoomToFeature
    });
  };
  function onEachFeature3(feature, layer) {
    layer.on({
      mouseover: highlightFeature3,
      mouseout: resetHighlight3,
      click: zoomToFeature
    });
  };
  
  // sublayer control - woodland
  function turnonwoodland() {
    if ((map.hasLayer(woodland)) || (map.hasLayer(tree))){
      woodland.remove();
      tree.remove();
    } else {
      woodland.addTo(map);
      tree.addTo(map);
    }
  };
  // sublayer control - meadow
  function turnonmeadow() {
    if (map.hasLayer(meadow)){
      meadow.remove();
    } else {
      meadow.addTo(map);
    }
  };
  // sublayer control - willow
  function turnonwillow() {
    if (map.hasLayer(willow)){
      willow.remove();
    } else {
      willow.addTo(map);
    }
  };
  // sublayer control - bush
  function turnonbush() {
    if (map.hasLayer(bush)){
      bush.remove();
    } else {
      bush.addTo(map);
    }
  };
  // sublayer control - largewood
  function turnonlargewood() {
    if (map.hasLayer(largewood)){
      largewood.remove();
    } else {
      largewood.addTo(map);
    }
  };
  // sublayer control - dam
  function turnondam() {
    if (map.hasLayer(Dam)){
      Dam.remove();
    } else {
      Dam.addTo(map);
    }
  };
  // sublayer control - barrier
  function turnonbarrier() {
    if ((map.hasLayer(BigBarrier)) || (map.hasLayer(SmallBarrier))){
      BigBarrier.remove();
      SmallBarrier.remove();
    } else {
      BigBarrier.addTo(map);
      SmallBarrier.addTo(map);
    }
  };
  // sublayer control - flood gate
  function turnongate() {
    if (map.hasLayer(Gate)){
      Gate.remove();
    } else {
      Gate.addTo(map);
    }
  };
  // sublayer control - culvert
  function turnonculvert() {
    if (map.hasLayer(geojson9)){
      geojson9.remove();
    } else {
      geojson9.addTo(map);
    }
  };
  // sublayer control - defences
  function turnondefence() {
    if (map.hasLayer(geojson8)){
      geojson8.remove();
    } else {
      geojson8.addTo(map);
    }
  };
  // polygon and line layers creation relative function
  function onEachFeature(feature, layer) {
    if (feature.properties && feature.properties.Type) {
        layer.bindPopup(feature.properties.Type);
    }
  };
  // left side bar control
  function accordion(id) {
    var x = document.getElementById(id);
    if (x.className.indexOf("w3-show") == -1) {
      x.className += " w3-show";
    } else { 
    x.className = x.className.replace("w3-show", "");
    }
  };
  // routing
  function route(value) {
    var geoCoords = [55.948162, -3.184111];
    if (value == 1) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.885996, -3.2684)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 2) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.903972, -3.149736)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 3) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.958252, -3.321601)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 4) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.915566, -3.253389)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 5) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.953041, -3.26958)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 6) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.926279, -3.14391)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 7) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.92147, -3.193846)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 8) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.947149, -3.161872)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 9) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.930196, -3.116148)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 10) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.963607, -3.215254)
        ],
        routeWhileDragging: true
      }).addTo(map);
    } else if (value == 11) {
      var route = L.Routing.control({
        waypoints:[
        L.latLng(geoCoords),
        L.latLng(55.965322, -3.207134)
        ],
        routeWhileDragging: true
      }).addTo(map);
    }
  };

  // Start Page Guide
  introJs().start();

  // Leaflet scripts
  // Base Maps
  var graymap = L.tileLayer(
    'http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
      maxZoom: 19, 
      minZoom: 10, 
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'
    }
  );
  var osm = L.tileLayer(
    'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, 
      minZoom: 10, 
      attribution: '&copy; <a href="http://osm.orgcopyright">OpenStreetMap</a> contributors'
    }
  );
  var map = L.map('mapid',{center:[55.913, -3.285], zoom:11, layers: graymap});
  // Scale and zoom viewer
  var scale = L.control.scale().addTo(map);
  const ZoomViewer = L.Control.extend({
    onAdd() {
      const gauge = L.DomUtil.create('div');
      gauge.style.width = '100px';
      gauge.style.background = 'rgba(255,255,255,0.5)';
      gauge.style.textAlign = 'left';
      map.on('zoomstart zoom zoomend', (ev) => {
        gauge.innerHTML = `Zoom level: ${map.getZoom()}`;
      });
      return gauge;
    }
  });
  const zoomViewer = (new ZoomViewer()).addTo(map);
  // Setting point icons
  var DamIcon = L.icon({
    iconUrl: 'images/icons/Dam.png',
    iconSize: [50.7, 45.4],
    iconAnchor: [12.4, 10.4],
  });
  var BigBarrierIcon = L.icon({
    iconUrl: 'images/icons/BigBarrier.png',
    iconSize: [50.7, 45.4],
    iconAnchor: [12.4, 10.4],
  });
  var SmallBarrierIcon = L.icon({
    iconUrl: 'images/icons/SmallBarrier.png',
    iconSize: [50.7, 45.4],
    iconAnchor: [12.4, 10.4],
  });
  var GateIcon = L.icon({
    iconUrl: 'images/icons/Gate.png',
    iconSize: [48.7, 32.4],
    iconAnchor: [12.4, 10.4],
  });
  var benchicon = L.icon({
    iconUrl: 'images/icons/bench.png',
    iconSize: [22.5, 10],
    iconAnchor: [11.1, 4.8],
    popupAnchor: [-3, -3]
  });
  var entranceicon = L.icon({
    iconUrl: 'images/icons/entrance.png',
    iconSize: [21.9, 24.5],
    iconAnchor: [12.2, 11.8],
    popupAnchor: [0, 0]
  });
  var mapicon = L.icon({
    iconUrl: 'images/icons/map.png',
    iconSize: [40, 30.6],
    iconAnchor: [19.5, 15],
  });
  var treeicon = L.icon({
    iconUrl: 'images/icons/tree.png',
    iconSize: [32.7, 30.4],
    iconAnchor: [12.4, 10.4],
  });
  // Create polygon layers
  var geojson1 = L.geoJson(Greenspace, {
    style: style1,
  });
  var geojson2 = L.geoJson(Env, {
    style: style2,
    onEachFeature: onEachFeature2
  });
  var geojson3 = L.geoJson(SIMD, {
    style: style3,
    onEachFeature: onEachFeature3
  });
 
  var geojson6 = L.geoJson(MediumRisk, {
    style: style5,
  });
  var geojson11 = L.geoJson(FloodMediumRisk, {
    style: style11,
  });
  var geojson12 = L.geoJson(SEPA, {
    style: style8,
  });
  var geojson13 = L.geoJson(Proposed, {
    style: style9,
  });
  var geojson14 = L.geoJson(City, {
    style: style13,
  });
   var geojson15 = L.geoJson(Education, {
            style: style14,
        })

   var geojson16 = L.geoJson(Healthcare, {
            style: style15,
        })
   geojson17= L.geoJson(Food, {
            style: style16,
        })
  var bush = L.geoJSON(polygon,{
    onEachFeature: onEachFeature,
    filter: function(poly, layer) {
      return poly.properties.Type == 'Bush';
    },
    style: {stroke: false, fill: 'url(images/icons/bush.png)', fillOpacity:'1.0'}
  });
  var largewood = L.geoJSON(polygon,{
    onEachFeature: onEachFeature,
    filter: function(poly, layer) {
      return poly.properties.Type == 'Large Wood';
    },
    style: {stroke: false, fill: 'url(images/icons/largewood.png)', fillOpacity:'1.0'}
  });
  var willow = L.geoJSON(polygon,{
    onEachFeature: onEachFeature,
    filter: function(poly, layer) {
      return poly.properties.Type == 'Livewillow';
    },
    style: {stroke: false, fill: 'url(images/icons/willow.png)', fillOpacity:'1.0'}
  });
  var meadow = L.geoJSON(polygon,{
    onEachFeature: onEachFeature,
    filter: function(poly, layer) {
      return poly.properties.Type == 'Meadow';
    },
    style: {stroke: false, fill: 'url(images/icons/meadow.png)', fillOpacity:'1.0'}
  });
  var river = L.geoJSON(polygon,{
    onEachFeature: onEachFeature,
    filter: function(poly, layer) {
      return poly.properties.Type == 'River';
    },
    style: {stroke: false, fill: 'url(images/icons/river.png)', fillOpacity:'1.0'}
  });
  var woodland = L.geoJSON(polygon,{
    onEachFeature: onEachFeature,
    filter: function(poly, layer) {
      return poly.properties.Type == 'Woodland';
    },
    style: {stroke: false, fill: 'url(images/icons/woodland.png)', fillOpacity:'1.0'}
  });
  // Create line layers
  var geojson5 = L.geoJson(River, {
            style: style12,
  });
  var geojson8 = L.geoJson(defence, {
    style: style6,
  });
  var geojson9 = L.geoJson(Culvert, {
    style: style7,
  });
  var prowall = L.geoJSON(line,{
    onEachFeature: onEachFeature,
    filter: function(line, layer) {
      return line.properties.Type == 'Flood Wall';
    },
    style: {color: "#00008b", weight:'8'}
  });
  var path = L.geoJSON(line,{
    onEachFeature: onEachFeature,
    filter: function(line, layer) {
      return line.properties.Type == 'Path';
    },
    style: {color: '#808080', weight:'10'}
  });
  // Create point layers
  var Dam = L.geoJSON(Management, {
    filter: function (Management, layer) {
      return Management.properties.Note == 'Dam';
    },
    pointToLayer: function (Management, latlng) {
      return L.marker(latlng, { icon: DamIcon }).bindPopup("Dam");
    }
  });
  var BigBarrier = L.geoJSON(Management, {
    filter: function (Management, layer) {
      return Management.properties.Note == 'Big Barrier';
    },
    pointToLayer: function (Management, latlng) {
      return L.marker(latlng, { icon: BigBarrierIcon }).bindPopup("Big Barrier");
    }
  });
  var SmallBarrier = L.geoJSON(Management, {
    filter: function (Management, layer) {
      return Management.properties.Note == 'Small Barrier';
    },
    pointToLayer: function (Management, latlng) {
      return L.marker(latlng, { icon: SmallBarrierIcon }).bindPopup("Small Barrier");
    }
  });
  var Gate = L.geoJSON(Management, {
    filter: function (Management, layer) {
      return Management.properties.Note == 'Flood Gate';
    },
    pointToLayer: function (Management, latlng) {
      return L.marker(latlng, { icon: GateIcon }).bindPopup("Flood Gate");
    }
  });
  var bench = L.geoJSON(point, {
    onEachFeature: onEachFeature,
    filter: function(point, layer) {
      return point.properties.Type == 'Bench';
    },
    pointToLayer: function(point, latlng) {
      return L.marker(latlng,{icon:benchicon});
    }
  });
  var entrance = L.geoJSON(point, {
    onEachFeature: onEachFeature,
    filter: function(point, layer) {
      return point.properties.Type == 'Entrance';
    },
    pointToLayer: function(point, latlng) {
      return L.marker(latlng,{icon:entranceicon});
    }
  });
  var maps = L.geoJSON(point, {
    onEachFeature: onEachFeature,
    filter: function(point, layer) {
      return point.properties.Type == 'Map & Guide';
    },
    pointToLayer: function(point, latlng) {
      return L.marker(latlng,{icon:mapicon});
    }
  });
  var tree = L.geoJSON(point, {
    onEachFeature: onEachFeature,
    filter: function(point, layer) {
      return point.properties.Type == 'Tree';
    },
    pointToLayer: function(point, latlng) {
      return L.marker(latlng,{icon:treeicon});
    }
  });
  //information for mouse over Env
  var info2 = L.control();
  info2.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info2'); // create a div with a class "info"
    this.update();
    return this._div;
  };
  info2.update = function (props) {
    this._div.innerHTML = '<h4>Environment Deprivation - Area of Greenspace</h4>' + (props ? '<b>' + props.Name + '</b><br />' + props.GreenAreaPerPerson + ' m<sup>2</sup>': 'Hover over');
  };
  //information for mouse over SIMD Rank
  var info3 = L.control();
  info3.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info3'); // create a div with a class "info"
    this.update();
    return this._div;
  };
  info3.update = function (props) {
    this._div.innerHTML = '<h4>SIMD Rank</h4>' + (props ? '<b>' + props.Name + '</b><br />' + props.SIMD2020v2: 'Hover over');
  };
  // Layer groups and layer controls
  var RiverManagement = L.layerGroup([Dam, BigBarrier, SmallBarrier, Gate, geojson8, geojson9, geojson5, geojson12, geojson13, geojson14]);
  var MediumRiskFlooding = L.layerGroup([geojson6, geojson14]);
  var Flooding = L.layerGroup([geojson11, geojson14]).addTo(map);
  var Greenspaces = L.layerGroup([geojson1, geojson14]);
  var  Soical=L.layerGroup([geojson3,geojson15,geojson16,geojson17]);

  var proposal = L.layerGroup([bush, largewood, willow, meadow, river, woodland, prowall, path, bench, entrance, maps, tree]);
  var baseMaps = {"CartoDB Positron": graymap, "OpenStreetMap": osm};
  var overlayMaps = {"Medium Flood In Edinburgh": Flooding, "People Affected By Medium Flood": MediumRiskFlooding, "River Management": RiverManagement, "Accessible Greenspace": Greenspaces};
  var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
  layerControl.addOverlay(geojson2, 'Environment Deprivation');
  layerControl.addOverlay(proposal, 'Proposal');
  layerControl.addOverlay(Soical, 'Social Deprivation');
  layerControl.addOverlay(geojson14, 'Edinburgh City');
  map.on('overlayadd', function(eo) {
    if (eo.name === 'Proposal'){
        map.setView(L.latLng(55.9164043, -3.3070006), 17)
    }
  });
  // Legends
  //Accessible Greenspaces
  var legend1 = L.control({ position: 'bottomright' });
  legend1.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info2 legend1'),
    grades = ['Play Space', 'Playing Field', 'Public Park Or Garden']
    div.innerHTML = '<h4>Accessible Greenspaces</h4>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
      div.innerHTML += '<i style="background:' + getColor1(grades[i]) + '"></i> ' + grades[i] + (grades[i + 1] ? '<br>' : '');
    }
    return div;
  };
  //Greenspace Provision
  var legend2 = L.control({ position: 'bottomright' });
  legend2.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info2 legend2'),
    grades = [0, 100, 300, 1000, 2050, 4100]
    div.innerHTML = '<h4>Greenspace Provision(m<sup>2</sup>) </br>Per Person </h4>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length - 1; i++) {
      div.innerHTML += '<i style="background:' + getColor2(grades[i]) + '"></i> ' +
        //grades[i] + (grades[i + 1] ? '<br>' : '');
        (grades[i + 1] ? + grades[i] + '&ndash;' + grades[i + 1] + '<br>' : '');
    }
    return div;
  };
  //SIMD Rank
  var legend3 = L.control({ position: 'bottomright' });
  legend3.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info2 legend3'),
    grades = [911, 1898, 2814, 3607, 4359, 5134, 5828, 6310, 6672, 6976]
    div.innerHTML = '<h4>SIMD Rank</h4>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length - 1; i++) {
      div.innerHTML += '<i style="background:' + getColor3(grades[i]) + '"></i> ' +
        //grades[i] + (grades[i + 1] ? '<br>' : '');
        (grades[i + 1] ? + grades[i] + '&ndash;' + grades[i + 1] + '<br>' : '');
    }
    return div;
  };
  //Population Affected By Flood
  var legend4 = L.control({ position: 'bottomright' });
  legend4.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info2 legend4'),
    grades = [1, 50, 100, 500, 1000]
    div.innerHTML = '<h4>Population Affected By Flood</h4>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
      div.innerHTML += '<i style="background:' + getColor4(grades[i]) + '"></i> ' +
        //grades[i] + (grades[i + 1] ? '<br>' : '');
        grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
    }
    return div;
  };
  //Defences
  var legend5 = L.control({ position: 'bottomright' });
  legend5.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info2 legend5'),
    grades = ['Embankment', 'Flood Wall', 'Flood Gate']
    div.innerHTML = '<h4>Defences</h4>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML += '<i style="background:' + getColor5(grades[i]) + '"></i> ' + grades[i] + (grades[i + 1] ? '<br>' : '');
    }
    return div;
  };
  //Pressure
  var legend6 = L.control({ position: 'bottomright' });
  legend6.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info2 legend6'),
    grades = ['Culvert']
    div.innerHTML = '<h4>Pressure</h4>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
      div.innerHTML += '<i style="background:' + '#88419d' + '"></i> ' + grades[i] + (grades[i + 1] ? '<br>' : '');
    }
    return div;
  };
  //Opportunity
  var legend7 = L.control({ position: 'bottomright' });
  legend7.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info2 legend7'),
    grades = ['SPEA Opportunity', 'Proposed Opportunity']
    div.innerHTML = '<h4>Opportunity</h4>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
      div.innerHTML += '<i style="background:' + getColor6(grades[i]) + '"></i> ' + grades[i] + (grades[i + 1] ? '<br>' : '');
    }
    return div;
  };
//Social Deprivation
        var legend8 = L.control({ position: 'bottomright' });

        legend8.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info2 legend8'),
            grades = ['Education Services Area', 'Healthcare Services Area', 'Food Services Area']

            div.innerHTML = '<h4>Social Deprivation</h4>'

            for (var i = 0; i < grades.length; i++) {

                div.innerHTML +=
                    '<i style="background:' + getColor8(grades[i]) + '"></i> ' +
                    grades[i] + (grades[i + 1] ? '<br>' : '');
            }
            return div;
        };
//DamIcon,BigBarrierIcon,SmallBarrierIcon,GateIcon
map.on('overlayadd', function (eventLayer) {
  if (eventLayer.name == 'Accessible Greenspace') {
    this.removeControl(legend2);
    this.removeControl(legend3);
    this.removeControl(legend4);
    this.removeControl(legend5);
    this.removeControl(legend6);
    this.removeControl(legend7);
    this.removeControl(legend8);
    this.removeControl(info2);
    this.removeControl(info3);
    legend1.addTo(map);
  }
  else if (eventLayer.name == 'Medium Flood In Edinburgh') {
    this.removeControl(legend1);
    this.removeControl(legend2);
    this.removeControl(legend3);
    this.removeControl(legend4);
    this.removeControl(legend5);
    this.removeControl(legend6);
    this.removeControl(legend7);
    this.removeControl(legend8);
    this.removeControl(info2);
    this.removeControl(info3);
  }
  else if (eventLayer.name == 'Environment Deprivation') {
    this.removeControl(legend1);
    this.removeControl(legend3);
    this.removeControl(legend4);
    this.removeControl(legend5);
    this.removeControl(legend6);
    this.removeControl(legend7);
    this.removeControl(legend8);
    this.removeControl(info3);
    legend2.addTo(map);
    info2.addTo(map);
  }
  else if (eventLayer.name == 'River Management') {
    this.removeControl(legend1);
    this.removeControl(legend2);
    this.removeControl(legend3);
    this.removeControl(legend4);
    this.removeControl(legend8);
    this.removeControl(info2);
    this.removeControl(info3);
    legend7.addTo(map);
    legend5.addTo(map);
    legend6.addTo(map);
  }
  else if (eventLayer.name == 'People Affected By Medium Flood') {
    this.removeControl(legend1);
    this.removeControl(legend2);
    this.removeControl(legend3);
    this.removeControl(legend5);
    this.removeControl(legend6);
    this.removeControl(legend7);
    this.removeControl(legend8);
    this.removeControl(info2);
    this.removeControl(info3);
    legend4.addTo(map);
  }
  else if (eventLayer.name == 'Proposal') {  
    this.removeControl(legend1);  
    this.removeControl(legend2);  
    this.removeControl(legend3);
    this.removeControl(legend4);  
    this.removeControl(legend5);  
    this.removeControl(legend6);  
    this.removeControl(legend7);  
    this.removeControl(legend8);  
    this.removeControl(info2);  
    this.removeControl(info3);  
 } 
  else if (eventLayer.name == 'Social Deprivation') {
                this.removeControl(legend1);
                this.removeControl(legend2);
                this.removeControl(legend3);
                this.removeControl(legend4);
                this.removeControl(legend5);
                this.removeControl(legend6);
                this.removeControl(legend7);
                this.removeControl(info2);
                legend8.addTo(map);
                legend3.addTo(map);
                info3.addTo(map);
            }
});
</script>
</html>
